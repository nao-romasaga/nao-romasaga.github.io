<!DOCTYPE html>
<html lang="ja">
<head>
    <script type="text/javascript" src="./js/jquery-3.3.1.min.js"></script>
    <script type="text/javascript" src="./js/jquery-ui.min.js"></script>
    <script type="text/javascript" src="./js/jquery.ui.touch-punch.js"></script>
    <script src="./js/dataload.js"></script>
    <script>
        // require dataload.js
        dataload([
            "data_FORMATION",
        ], false);
    </script>    

    <!-- Global site tag (gtag.js) - Google Analytics         -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-138966739-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() {
            dataLayer.push(arguments);
        }
        gtag('js', new Date());

        gtag('config', 'UA-138966739-1');
    </script>
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <meta charset="utf-8">
    <title>【ロマサガRS】陣形一覧</title>
    <meta property="og:title" content="【ロマサガRS】陣形一覧" />
    <meta property="og:url" content="https://nao-romasaga.github.io/formation.html" />
    <meta property="og:description" content="ロマサガRSの陣形一覧です" />
    <meta name="description" content="ロマサガRSの陣形一覧です。攻略の際にご利用ください。【ロマンシングサガ リユニバース】" />
    <!--<meta property="og:image" content="https://nao-romasaga.github.io/img/twitter_card_autodamage.png" />-->
    <meta property="og:site_name" content="ロマサガRS便利ツール" />
    <meta property="og:type" content="article">
    <meta property="og:locale" content="ja_JP" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@nao_romasaga_rs" />
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" type="text/css" href="./css/bootstrap/bootstrap.min.css">
    <script src="./js/bootstrap.min.js"></script>
    <link rel="stylesheet" type="text/css" href="./css/style2.css">
    <link rel="stylesheet" type="text/css" href="./css/formation.css">

    <script src="https://www.gstatic.com/firebasejs/5.9.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.9.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.9.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/ui/3.5.2/firebase-ui-auth__ja.js"></script>
    <link type="text/css" rel="stylesheet" href="https://cdn.firebase.com/libs/firebaseui/3.5.2/firebaseui.css" />
    <script src="./js/Firebase.js"></script>
    <script src="./js/utils2.js"></script>
    <link href="https://fonts.googleapis.com/css?family=M+PLUS+Rounded+1c" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Merriweather" rel="stylesheet">
    <style>
    </style>
</head>

<body>
    <div class ="haikei">
        <div class="container">
            <h3 class="text-center title-text">陣形 一覧</h3>
            <div id="firebaseui-auth-container" style="margin-bottom:10px;"></div>

            <div class="bg-black-window">
                <div class="d-flex flex-wrap" style="justify-content: space-around; align-items: center;">
                    <div style="width:200px;">
                        <div class="formation-area-large">
                            <img src="https://romasagatool.com/img/bg_formation.png" class="formation-img">
                            <span class="f-pos f-pos-large pos1">❶</span>
                            <span class="f-pos f-pos-large pos2">❷</span>
                            <span class="f-pos f-pos-large pos3">❸</span>
                            <span class="f-pos f-pos-large pos4">❹</span>
                            <span class="f-pos f-pos-large pos5">❺</span>
                        </div>
                    </div>
                    <div class=" " style="padding: 0px 25px; min-width:400px; max-width: 70%;">
                        <div class="formation-name fuchidori-white bg-item text-center width-100">陣形名</div>
                        <div style="overflow-x: scroll; padding-bottom: 30px;">
                            <table border="1" class="text-nowrap width-100">
                                <thead>
                                    <tr class="odd-row" style="line-height: 1rem;">
                                        <td>No</td>
                                        <td class="param-header">腕</td>
                                        <td class="param-header">体</td>
                                        <td class="param-header">器</td>
                                        <td class="param-header">速</td>
                                        <td class="param-header">知</td>
                                        <td class="param-header">精</td>
                                        <td class="param-header">愛</td>
                                        <td class="param-header">魅</td>
                                        <td class="param-header">攻撃</td>
                                        <td class="param-header">防御</td>
                                        <td class="param-header">行動</td>
                                        <td class="param-header" style="line-height: 1rem;">被弾<br>(※)</td>
                                        <td>アビリティ</td>
                                    </tr>
                                </thead>
                                <tbody id="FORMATION_INFO_BODY"></tbody>
                                <tfoot>
                                    <tr id="FORMATION_ROW_TEMPLATE" class="d-none text-right odd-row" style="    border: 1px solid darkkhaki;">
                                        <td class="No"></td>
                                        <td class="STR"></td>
                                        <td class="VIT"></td>
                                        <td class="DEX"></td>
                                        <td class="AGI"></td>
                                        <td class="INT"></td>
                                        <td class="MND"></td>
                                        <td class="AI"></td>
                                        <td class="MI"></td>
                                        <td class="ATK"></td>
                                        <td class="DEF"></td>
                                        <td class="ACT"></td>
                                        <td>
                                            <div class="HATE d-flex" style="align-items: center; justify-content: space-around;"></div>
                                        </td>
                                        <td class="ABILITY text-left"></td>
                                    </tr>
                                </tfoot>
                            </table>
                            ※: 狙われやすさから概算。実際の被弾率とは異なります
                        </div>
                    </div>
                    <div class="width-100">
                        <div class="formation-flover">陣形説明文</div>
                    </div>
                </div>
            </div>
            <div class="style-bgcolor" style="padding: 20px 5px;">
                <div class="subtitle-long">ステータス上昇　</div>
                <div class="d-flex" style="justify-content: space-evenly;">
                    <div class="d-flex flex-column filter-button yubi _FILTER" data-id="plus_STR">
                        <span class="withLabel icon_mini_zokusei icon_buff_str"></span>
                        <span class="text-center text-nowrap width-100 label-area" id="count_STR"></span>
                    </div>
                    <div class="d-flex flex-column filter-button yubi _FILTER" data-id="plus_VIT">
                        <span class="withLabel icon_mini_zokusei icon_buff_vit"></span>
                        <span class="text-center text-nowrap width-100 label-area" id="count_VIT"></span>
                    </div>                    
                    <div class="d-flex flex-column filter-button yubi _FILTER" data-id="plus_DEX">
                        <span class="withLabel icon_mini_zokusei icon_buff_dex"></span>
                        <span class="text-center text-nowrap width-100 label-area" id="count_DEX"></span>
                    </div>                    
                    <div class="d-flex flex-column filter-button yubi _FILTER" data-id="plus_AGI">
                        <span class="withLabel icon_mini_zokusei icon_buff_agi"></span>
                        <span class="text-center text-nowrap width-100 label-area" id="count_AGI"></span>
                    </div>                    
                    <div class="d-flex flex-column filter-button yubi _FILTER" data-id="plus_INT">
                        <span class="withLabel icon_mini_zokusei icon_buff_int"></span>
                        <span class="text-center text-nowrap width-100 label-area" id="count_INT"></span>
                    </div>                    
                    <div class="d-flex flex-column filter-button yubi _FILTER" data-id="plus_MND">
                        <span class="withLabel icon_mini_zokusei icon_buff_mnd"></span>
                        <span class="text-center text-nowrap width-100 label-area" id="count_MND"></span>
                    </div>                    
                    <div class="d-flex flex-column filter-button yubi _FILTER" data-id="plus_AI">
                        <span class="withLabel icon_mini_zokusei icon_buff_ai"></span>
                        <span class="text-center text-nowrap width-100 label-area" id="count_AI"></span>
                    </div>                    
                    <div class="d-flex flex-column filter-button yubi _FILTER" data-id="plus_MI">
                        <span class="withLabel icon_mini_zokusei icon_buff_mi"></span>
                        <span class="text-center text-nowrap width-100 label-area" id="count_MI"></span>
                    </div>
                </div>
                <div class="subtitle-long">ステータス下降　</div>
                <div class="d-flex" style="justify-content: space-evenly;">
                    <div class="d-flex flex-column filter-button yubi _FILTER" data-id="minus_STR">
                        <span class="withLabel icon_mini_zokusei icon_debuff_str"></span>
                        <span class="text-center text-nowrap width-100 label-area" id="count_minus_STR"></span>
                    </div>
                    <div class="d-flex flex-column filter-button yubi _FILTER" data-id="minus_VIT">
                        <span class="withLabel icon_mini_zokusei icon_debuff_vit"></span>
                        <span class="text-center text-nowrap width-100 label-area" id="count_minus_VIT"></span>
                    </div>                    
                    <div class="d-flex flex-column filter-button yubi _FILTER" data-id="minus_DEX">
                        <span class="withLabel icon_mini_zokusei icon_debuff_dex"></span>
                        <span class="text-center text-nowrap width-100 label-area" id="count_minus_DEX"></span>
                    </div>                    
                    <div class="d-flex flex-column filter-button yubi _FILTER" data-id="minus_AGI">
                        <span class="withLabel icon_mini_zokusei icon_debuff_agi"></span>
                        <span class="text-center text-nowrap width-100 label-area" id="count_minus_AGI"></span>
                    </div>                    
                    <div class="d-flex flex-column filter-button yubi _FILTER" data-id="minus_INT">
                        <span class="withLabel icon_mini_zokusei icon_debuff_int"></span>
                        <span class="text-center text-nowrap width-100 label-area" id="count_minus_INT"></span>
                    </div>                    
                    <div class="d-flex flex-column filter-button yubi _FILTER" data-id="minus_MND">
                        <span class="withLabel icon_mini_zokusei icon_debuff_mnd"></span>
                        <span class="text-center text-nowrap width-100 label-area" id="count_minus_MND"></span>
                    </div>                    
                    <div class="d-flex flex-column filter-button yubi _FILTER" data-id="minus_AI">
                        <span class="withLabel icon_mini_zokusei icon_debuff_ai"></span>
                        <span class="text-center text-nowrap width-100 label-area" id="count_minus_AI"></span>
                    </div>                    
                    <div class="d-flex flex-column filter-button yubi _FILTER" data-id="minus_MI">
                        <span class="withLabel icon_mini_zokusei icon_debuff_mi"></span>
                        <span class="text-center text-nowrap width-100 label-area" id="count_minus_MI"></span>
                    </div>
            </div>

            <div class="" style="padding: 20px 5px;">
                <div class="subtitle-long">陣形一覧　</div>
                <div class="d-flex flex-wrap" id="F_LIST_AREA" style="justify-content: center;"></div>
            </div>
        </div>
    </div>
    <!--テンプレート-->
    <div class="d-none FORMATION_ICON yubi flex-column" style="align-items: center;" id="FORMATION_LIST_TEMPLATE">
        <div class="formation-area">
            <img src="https://romasagatool.com/img/bg_formation.png" class="formation-img">
            <span class="f-pos pos1">●</span>
            <span class="f-pos pos2">●</span>
            <span class="f-pos pos3">●</span>
            <span class="f-pos pos4">●</span>
            <span class="f-pos pos5">●</span>
        </div>
        <span class="text-center text-nowrap width-100 label-area f-name">フリーファイト</span>
    </div>

    <script>
        const ICON_PATH = {
            "-3": "icon_down_3.png",
            "-2": "icon_down_2.png",
            "-1": "icon_down_1.png",
            "0" : "icon_ind_1.png",
            "1": "icon_up_1.png",
            "2": "icon_up_2.png",
            "3": "icon_up_3.png",
        }

        const v = 1.3;
        const vL = 3.5;
        let PLUS_COUNT = {};
        let MINUS_COUNT = {};
        let NOW_FORMATION_DATA;

        $(document).ready(function ($) {
            NOW_FORMATION_DATA = data_FORMATION;
            initFormation();
        });

        function initFormation() {
            
            displayFilteredFormation(data_FORMATION);
            countFormationAttr(data_FORMATION);
        }
        function displayFilteredFormation(formations){
            $("#F_LIST_AREA").html("");
            for(let i in formations){
                const formation = formations[i];
                let formationBox = $("#FORMATION_LIST_TEMPLATE").clone().attr("id",formation['Id']).removeClass("d-none").addClass("d-flex");
                formationBox.find(".f-name").html(formation['Name']);
                formationBox.attr('data-id', i);

                for(let j in formation['Pos']){
                    const pos = formation['Pos'][j];
                    formationBox.find(".pos"+(Number(j)+1)).attr('style', `top: ${Number(pos['y']) * v - 5}px; left: ${Number(pos['x']) * v + 3}px;`);
                }
                formationBox.attr('data-plus', formation['plus']);
                formationBox.attr('data-minus', formation['minus']);
                $("#F_LIST_AREA").append(formationBox);
            }
        }

        function countFormationAttr(formationList) {
            PLUS_COUNT = {};
            MINUS_COUNT = {};            
            for(let i in formationList){
                const formation = formationList[i];
                for(let p of (formation['plus'] || "").split("/")) {
                    if(p == "") continue;
                    if(typeof PLUS_COUNT[p] == "undefined") {
                        PLUS_COUNT[p] = 0;
                    }
                    PLUS_COUNT[p]++;
                }
                for(let p of (formation['minus'] || "").split("/")) {
                    if(p == "") continue;
                    if(typeof MINUS_COUNT[p] == "undefined") {
                        MINUS_COUNT[p] = 0;
                    }
                    MINUS_COUNT[p]++;
                }
            }
            for(let key of PARAM_KEY) {
                $("#count_" + key).html(PLUS_COUNT[key] || 0).addClass("zero");
                if($("#count_" + key).html() != "0"){
                    $("#count_" + key).removeClass("zero");
                }
                $("#count_minus_" + key).html(MINUS_COUNT[key] || 0).addClass("zero");
                if($("#count_minus_" + key).html() != "0"){
                    $("#count_minus_" + key).removeClass("zero");
                }
            }
        }

        let plus_filter = [];
        let minus_filter = [];
        $(document).on('click', '._FILTER', function () {
            const id = $(this).attr('data-id');
            const isAddFlag = !$(this).hasClass("filterActive");
            $(this).toggleClass("filterActive");
            // filter配列にデータを入れたり出したり
            _filterCreate(id, isAddFlag);
        
            let result = [];
            if((plus_filter.length + minus_filter.length) == 0) {
                result = data_FORMATION;
            } else {
                for(let i in data_FORMATION){
                    const formation = data_FORMATION[i];
                    let attr1 = (formation['plus'] ?? "").split("/").filter(
                        x => plus_filter.indexOf(x) > -1
                    );
                    let attr2 = (formation['minus'] ?? "").split("/").filter(
                        x => minus_filter.indexOf(x) > -1
                    );
                    if(attr1.length == plus_filter.length
                    && attr2.length == minus_filter.length) {
                        result.push(formation);
                    }                    
                }
            }
            NOW_FORMATION_DATA = result ;
            displayFilteredFormation(result);
            countFormationAttr(result);
        });
        

        $(document).on('click', '.FORMATION_ICON', function () {
            const id = $(this).attr('data-id');
            const formation = NOW_FORMATION_DATA[id];
            changeFormationInfo(formation);
        });

        function changeFormationInfo(data){
            $(".formation-name").html(data['Name']);
            $(".formation-flover").html(data['FlavorText']);
            $("#FORMATION_INFO_BODY").html("");
            let hateList = [];
            for(i in data['Pos']) {
                let p = data['Pos'][i];
                let bonus = data_FORMATION_BONUS[p['bonusId']];                
                hateList.push((Number(bonus['HitRate'] ?? 0) ) * 500 + 2000 );
            }
            const hateTotal = hateList.reduce(function(sum, element){
            return sum + element;
            }, 0);
            
            for(i in data['Pos']) {
                let p = data['Pos'][i];
                $(".formation-area-large").find(".pos"+(Number(i)+1)).attr('style', `top: ${Number(p['y']) * vL - 18}px; left: ${Number(p['x']) * vL + 0        }px;`);

                let $tr = $("#FORMATION_ROW_TEMPLATE").clone().attr("id",'').removeClass("d-none");
                let bonus = data_FORMATION_BONUS[p['bonusId']];
                $tr.find(`.No`).html(Number(i)+1);
                for(key of PARAM_KEY) {
                    if(bonus[key]) {
                        let v = Number(bonus[key]);
                        let clz = (v > 0) ? "fuchidori-blue" : "shadow-red resist-minus";
                        $tr.find(`.${key}`).addClass(clz).html(v);
                    }
                }
                $tr.find(`.No`).html(Number(i)+1);
                const ability = data_FORMATION_ABILITY[bonus['AbilityId']];
                if(typeof ability != "undefined") {
                    $tr.find(`.ATK`).html(ability['Atk'] ? ability['Atk'] +"%" : "");
                    $tr.find(`.DEF`).html(ability['Def'] ? ability['Def'] +"%" :  "");
                    $tr.find(`.ACT`).html(ability['Act'] ? "Qs:"+ability['Act'] :  "");
                    $tr.find(`.ABILITY`).html(ability['Name'] ?? "");
                }

                let imgPath = getImgPath("icon/"+ICON_PATH[bonus['HitRate'] ?? 0]);
                let imgClass = (bonus['HitRate'] ?? 0) == 0 ? "ind_0" : "";
                $tr.find(`.HATE`).html(`<img class="hate-icon ${imgClass}" src="${imgPath}?v=1"> ${Math.floor((hateList[i] / hateTotal) * 100)}%`);
                
                $("#FORMATION_INFO_BODY").append($tr);
            }
        }

        function _filterCreate(id, isAddFlag) {
            if(id.indexOf("plus_") > -1) {
                let target = id.replace("plus_","");
                if(isAddFlag) {
                    plus_filter.push(target);
                } else {
                    plus_filter = plus_filter.filter(x => x != target);
                }
            } else {
                let target = id.replace("minus_","");
                if(isAddFlag) {
                    minus_filter.push(target);
                } else {
                    minus_filter = minus_filter.filter(x => x != target);
                }
            }            
        }        
    </script>
    <script type="text/javascript" src="https://romasagatool.com/blog/get_the_archives.php?limit=30&callback=rssCallback"></script>
</body>
</html>

陣形一覧ページを作成しました
知力が上がる陣形ってなんだっけ？とか
パワレ改の軽減率っていくつだったっけ？とか調べる時にご利用ください

なんちゃって被弾率もあります
https://nao-romasaga.github.io/formation.html
#ロマサガRS